---
title: "COVID-19 Interventions Analysis"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{interventions_analysis}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}

library(devtools)
library(usethis)
library(covid19interventions)

# run if you don't have covid19clark
devtools::install_github("agroimpacts/covid19clark")

library(covid19interventions)
# run if you don't have covid19clark
# devtools::install_github("agroimpacts/covid19clark", build_vignettes = TRUE)

library(covid19clark)
```


```{r}
# data load
# covid interventions by county
data("county_interventions")
# covid cases
data("us_cases_daily")
```

```{r}
# interventions
head(county_interventions)
# covid cases by county
head(us_cases_daily$county)
```


```{r}
#------------------------------------------------------------------------------------------------------------
# How many cases and deaths were recorded the date the intervention measures were put in place?
library(dplyr)
library(tidyr)

df1 <- as.data.frame(county_interventions)
df1$admin2 <- sapply(df1$admin2, tolower)
df1$admin1 <- sapply(df1$admin1, tolower)
df1$acronym <- sapply(df1$acronym, tolower)

df1$admin2_rep = str_replace(df1$admin2, " county", "")

df2 <- as.data.frame(us_cases_daily$county)

#------------------------------------------------------------------------------------------------------------
#Values for day of
cima2 <- inner_join(df1,df2, by = c("SAH_County_Date" = "date",
                                    "admin1" = "state1", 
                                    "admin2_rep" = "county.x")) %>% 
  group_by(admin2_rep) %>% mutate(case_pop = cases / pop)


#------------------------------------------------------------------------------------------------------------
#new dataframe of cases one week before
before1 <- df1
before1$SAH_County_Date = before1$SAH_County_Date - 7 

before1_df <- inner_join(before1,df2, by = c("SAH_County_Date" = "date",
                                    "admin1" = "state1", 
                                    "admin2_rep" = "county.x")) %>% 
  group_by(admin2_rep) %>% mutate(case_pop = cases / pop)

#------------------------------------------------------------------------------------------------------------
#New dataframe of cases one week after
after <- df1
after$SAH_County_Date = after$SAH_County_Date + 7 

after_df <- inner_join(after,df2, by = c("SAH_County_Date" = "date",
                                    "admin1" = "state1", 
                                    "admin2_rep" = "county.x")) %>% 
  group_by(admin2_rep) %>% mutate(case_pop = cases / pop)

#------------------------------------------------------------------------------------------------------------
#Plot
library(ggplot2)
library(tidyverse)


g <- ggplot(data = cima2, aes(x=cima2$admin2_rep, y=case_pop)) + geom_bar( stat="identity", fill = 'steelblue')
g


```


=======
>>>>>>> 11f5f32de5ce063f2f0450fc242109548c9e10c5
